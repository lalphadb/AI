# ğŸ— Architecture Technique - AI Orchestrator v5.2

## Vue d'Ensemble

AI Orchestrator est conÃ§u selon une architecture modulaire en couches, permettant une maintenance facile et une sÃ©paration claire des responsabilitÃ©s.

---

## Diagramme d'Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INFRASTRUCTURE 4LB.CA                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚   Traefik   â”‚â”€â”€â”€â”€â–¶â”‚   Nginx     â”‚â”€â”€â”€â”€â–¶â”‚   Frontend (HTML)   â”‚  â”‚
â”‚   â”‚   (HTTPS)   â”‚     â”‚  (Static)   â”‚     â”‚   WebSocket Client  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                                          â”‚               â”‚
â”‚          â”‚ /api, /ws                                â”‚ WSS           â”‚
â”‚          â–¼                                          â–¼               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    BACKEND (FastAPI)                         â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚  â”‚   Auth   â”‚  â”‚  Engine  â”‚  â”‚  Router  â”‚  â”‚  Rate Limit â”‚  â”‚  â”‚
â”‚   â”‚  â”‚   JWT    â”‚  â”‚  ReAct   â”‚  â”‚  Query   â”‚  â”‚   + Audit   â”‚  â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚
â”‚   â”‚                      â”‚                                        â”‚  â”‚
â”‚   â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
â”‚   â”‚         â–¼                         â–¼                          â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â”‚
â”‚   â”‚   â”‚   Tools   â”‚           â”‚  LLM Client   â”‚                  â”‚  â”‚
â”‚   â”‚   â”‚  (57+)    â”‚           â”‚   (Ollama)    â”‚                  â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                         â”‚                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â–¼                   â–¼     â–¼                   â–¼                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ SSH â”‚  â”‚Dockerâ”‚  â”‚Filesâ”‚  â”‚           OLLAMA               â”‚    â”‚
â”‚ â”‚Host â”‚  â”‚ API â”‚  â”‚ I/O â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â”‚  â”‚Qwen32Bâ”‚ â”‚DeepSeekâ”‚ â”‚Vision â”‚ â”‚    â”‚
â”‚                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”‚      DATA LAYER         â”‚                                        â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                        â”‚
â”‚ â”‚  â”‚ChromaDBâ”‚ â”‚ SQLite â”‚  â”‚                                        â”‚
â”‚ â”‚  â”‚(Memory)â”‚ â”‚  (DB)  â”‚  â”‚                                        â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Composants Principaux

### 1. Engine ReAct (engine.py)

Le cÅ“ur de l'orchestrateur. ImplÃ©mente la boucle Reason-Act-Observe.

**Cycle** :
1. **THINK** - Analyser la requÃªte utilisateur
2. **PLAN** - DÃ©finir les Ã©tapes nÃ©cessaires
3. **ACT** - ExÃ©cuter un outil
4. **OBSERVE** - Analyser le rÃ©sultat
5. **REPEAT** ou **RESPOND**

**CaractÃ©ristiques** :
- Maximum 15 itÃ©rations par requÃªte
- Collecte des rÃ©sultats pour rÃ©ponse finale
- Streaming des Ã©vÃ©nements via callback
- Gestion des erreurs avec retry

### 2. Tool Registry (tools/__init__.py)

SystÃ¨me de dÃ©corateurs pour l'enregistrement dynamique des outils.

```python
@register_tool("nom_outil", description="...", parameters={...})
async def mon_outil(params: dict) -> str:
    ...
```

### 3. Security Module (security.py)

- Blacklist de 30+ commandes dangereuses
- Validation des chemins (protection symlinks)
- Patterns dangereux (fork bomb, reverse shell, etc.)
- Audit logging

### 4. Authentication (auth.py)

- JWT avec expiration 1h
- API Keys pour intÃ©grations
- Sessions SQLite
- Rate limiting par IP/user

---

## Flux de DonnÃ©es

```
Client Request
       â”‚
       â–¼
   Traefik (TLS)
       â”‚
       â–¼
   Auth Middleware â”€â”€â–º 401 if invalid
       â”‚
       â–¼
   Rate Limiter â”€â”€â–º 429 if exceeded
       â”‚
       â–¼
   Query Router
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â–¼       â–¼
Factual  Operational
   â”‚       â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â–¼
   Engine ReAct
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â–¼       â–¼
  LLM   Tools
   â”‚       â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â–¼
   Response
```

---

## RÃ©seau Docker

### Topology

```
UNIFIED-NET (192.168.200.0/24)
â”‚
â”œâ”€â”€ traefik      (192.168.200.1)  - Reverse proxy
â”œâ”€â”€ backend      (192.168.200.11) - FastAPI
â”œâ”€â”€ frontend     (192.168.200.12) - Nginx
â”œâ”€â”€ chromadb     (192.168.200.13) - Vector DB
â”œâ”€â”€ postgres     (192.168.200.20) - SQL DB
â”œâ”€â”€ redis        (192.168.200.21) - Cache
â”œâ”€â”€ grafana      (192.168.200.14) - Monitoring
â””â”€â”€ prometheus   (192.168.200.22) - Metrics
```

### Ports

| Port | Service | AccÃ¨s |
|------|---------|-------|
| 443 | Traefik HTTPS | Public |
| 8001 | Backend API | Docker |
| 8002 | Frontend | Docker |
| 8000 | ChromaDB | Docker |
| 11434 | Ollama | Host |

---

## SÃ©curitÃ© Architecturale

### Defense in Depth

```
Layer 1: Network
   â””â”€ UFW Firewall
   â””â”€ GeoBlock (pays autorisÃ©s)

Layer 2: Edge
   â””â”€ Traefik + CrowdSec IPS
   â””â”€ TLS 1.3

Layer 3: Application
   â””â”€ JWT Auth
   â””â”€ Rate Limiting

Layer 4: Execution
   â””â”€ Command Blacklist
   â””â”€ Path Validation

Layer 5: Audit
   â””â”€ Logging complet
```

---

*Documentation Architecture - AI Orchestrator v5.2*
