{
  "description": "Sauvegarde compl√®te de StudiosDB",
  "steps": [
    {
      "type": "command",
      "command": "mkdir",
      "args": ["-p", "/home/studiosdb/backups/{{backup_date}}"],
      "timeout": 5000
    },
    {
      "type": "command",
      "command": "mysqldump",
      "args": ["-u", "root", "studiosdb"],
      "timeout": 60000,
      "output_file": "/home/studiosdb/backups/{{backup_date}}/database.sql"
    },
    {
      "type": "command",
      "command": "tar",
      "args": ["-czf", "/home/studiosdb/backups/{{backup_date}}/files.tar.gz", "studiosunisdb"],
      "timeout": 120000,
      "working_directory": "/home/studiosdb"
    },
    {
      "type": "command",
      "command": "ls",
      "args": ["-lah", "/home/studiosdb/backups/{{backup_date}}"],
      "timeout": 5000
    },
    {
      "type": "command",
      "command": "find",
      "args": ["/home/studiosdb/backups", "-type", "d", "-mtime", "+30", "-exec", "rm", "-rf", "{}", "+"],
      "timeout": 30000,
      "condition": {
        "type": "success"
      }
    }
  ]
}